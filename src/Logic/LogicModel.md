<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript">
</script>

## 城市间人口迁移模拟算法设计

算法基于因素-强度-敏感度三元模型，结合“拉力-推力”思想，分为以下模块：计算城市对不同人群的吸引力、判断群体是否迁出、选择迁入城市、估算迁移概率与规模、处理城市容量约束、更新城市因子并稳定化，以及模拟步长设置。各模块的输入、处理过程、输出及关键参数如下所述。所有因子值需先归一化至 $[0,1]$
（如 Min-Max 线性映射），人群对各因子的敏感度 $w_i$ 作为权重（$\sum_i w_i=1$），方向可为“拉力”（Positive）或“推力”（Negative）。

### 吸引力计算

- **输入**：城市 $C$ 的各因子原始值 ${v_i}$，每个因子定义了标准化方式（如最小-最大）和默认方向。人群 $G$
  对各因子有敏感度权重 ${w_i}$ 和（可选）覆盖方向。

- **计算**：首先将城市因子值标准化为 $s_i\in[0,1]$；然后按拉力因子/推力因子分别加权求和：

    - 拉力总和：$\mathrm{Pull}=\sum_{i\in\text{拉力}} w_i,s_i$；

    - 推力总和：$\mathrm{Push}=\sum_{i\in\text{推力}} w_i,(1-s_i)$；

    - 综合吸引指数：$\mathrm{Attraction}(C,G)=A_G\bigl(\mathrm{Pull}-\mathrm{Push}\bigr)$。其中 $A_G$
      为群体灵敏度缩放系数（默认 $A_G=1$）。值越高表示城市对该群体吸引力越强，可能为负表示排斥。

- **输出**：城市 $C$ 对群体 $G$ 的吸引力评分 $A(C,G)$。

- **参数**：各因子敏感度 $w_i$（默认可从调查或经验设定）；灵敏度缩放 $A_G$（默认 1）；因子归一化方式（默认 Min-Max）；方向覆盖等。

### 迁出决策

- **输入**：群体 $G$ 当前城市 $O$ 的吸引力 $A(O,G)$，各候选城市 $C$ 的吸引力 $A(C,G)$，群体属性：总人口 $N_G$、
  迁移意愿上限 $m$、保留率 $r$、吸引阈值 $\tau$、最低可接受吸引力 $\alpha_{\min}$。

- **计算**：对每个潜在目标城市 $C$，计算吸引差 $\Delta A=A(C,G)-A(O,G)$。只有当 $\Delta A>\tau$ 且 $A(C,G)>\alpha_{\min}$
  时，才考虑迁移；否则视作不满足迁移条件。若对至少一个目标满足条件，则群体将有一部分人口考虑迁出。具体而言，
  可先计算潜在迁出人数$M=N_G\times m$
  ，然后考虑固定比例不迁出（保留率）。例如，可将有效迁出概率设为 $(1-r)\times\Pr(\text{满足条件})$。

- **输出**：群体 $G$ 中考虑迁出的潜在人群规模（或概率）。后续再基于概率抽样实际迁出人数。

- **参数**：迁移意愿上限 $m\in[0,1]$（默认可设如 0.2–0.5 表示最多 20%–50% 愿迁），保留率 $r\in[0,1]$（默认可设如 0.05，表示至少
  5%
  留下），吸引阈值 $\tau$（如 0 或小正值），最低吸引力阈 $\alpha_{\min}$（如 0.2）。

### 目标城市选择

- **输入**：对每个满足条件的目标城市 $C$，已得迁移基础概率 $p_C$（见下节计算）。群体规模 $M$ 以及城市之间的地理/政策成本。

- **计算**：可将迁移视为两阶段决策 ：第一阶段决定是否迁出（前面已处理），第二阶段在各可行目标中选择。常用方法是将不同目标的吸引力映射到概率分布，
  然后按多项分布采样。具体可将 $p_C$ 归一化（$\sum_C p_C\le1$），然后令迁出人口 $M$ 按这些概率分配到各目标城市（或对每个城市做二项抽样）。
  例如，可令目标选择概率 $\pi_C = p_C/\sum_{C'}p_{C'}$，然后 $X_C\sim \mathrm{Binomial}(M,\pi_C)$。这样一个人只去一个城市，
  且不同目标的人数之和不超过 $M$。

- **输出**：群体 $G$ 中实际迁往每个城市 $C$ 的人数 ${X_C}$。

- **参数**：目标选择概率可直接使用下节算出的 $p_C$；若希望按最优吸引选择，则可简单选最大 $A(C,G)$的城市；更复杂可引入历史迁移偏好、
  社会网络等后续扩展。

### 迁移概率与规模估计

- **输入**：对每个目标城市 $C$，吸引差 $\Delta A=A(C,G)-A(O,G)$，迁移成本（如距离、政策阻力）$d_{O,C}$。群体规模 $N_G$ 和相关参数。

- **计算**：首先计算迁移基础概率（rawRate），可用 Sigmoid 函数将吸引差映射到 $[0,1]$：
  $\mathrm{rawRate}=\frac{1}{1+\exp{[−k(ΔA−0)]}}$

  其中 $k>0$ 是陡峭度系数（默认可取 1）。然后考虑迁移成本因子，例如使用指数衰减：
  $p_C=\mathrm{rawRate}×e^{−λd_{O,C}}$

  其中 $\lambda>0$ 控制成本敏感度（越大衰减越快）。成本 $d_{O,C}$
  可包含距离（公里）、文化/政策障碍等加权和。这样成本高的城市会降低迁移概率。最后保证 $0\le p_C\le1$。

- **规模抽样**：得到每个目标的迁移概率 $p_C$ 后，可计算群体预期迁移人数 $E_C=N_G\times p_C$，但实际迁移应保留随机性。
  推荐使用随机采样：将可迁移人数视为样本总数，用二项分布或多项分布抽样得到实际迁移人数。例如，按概率独立对每个人迁往各目标做二项抽样，
  或对整体做多项抽样，以产生自然的部分迁移现象。这样，移出人数不会固定，而是服从概率分布，避免“全迁”假设。

- **输出**：群体 $G$ 中迁往每个城市 $C$ 的实际人数（可能取整或四舍五入）。剩余（未迁出）人数保留在原城市。

- **参数**：Sigmoid 陡峭度 $k$（默认 1），成本敏感度 $\lambda$（默认如 0.01–0.1），可定义不同成本因子的加权系数。

### 城市容量与优先调节

- **输入**：各目标城市 $C$ 的容量（承载上限）$K_C$ 和当前人口（迁入前）；各城市拟迁入总人数 $\sum_G X_{G\to C}$。

- **计算**：若某城市 $C$ 的需求迁入人数超过剩余容量 $K_C-\text{currentPop}$，则需要缩减。常用方法是按比例或优先级调整：
  例如将所有群体的迁入人数按比例缩减，使总和恰好填满；或者先按某些规则（如技能、身份）排序高优先级群体，分配容量后剩余再给后续群体。总之，保证
  最终迁入人数不超过容量上限。这样可避免城市过度超载。

- **输出**：每个目标城市最终接受的迁入人数，以及超出容量的迁移失败人数（仍留在原地或重新分配）。

- **参数**：容量 $K_C$ 可由城市住房或设施规模估计（默认全市永久居民上限）。优先级规则可作为策略扩展；默认可使用简单比例法。

### 迁移后城市因素反馈

- **输入**：各城市迁出迁入后的人口变化 $\Delta P$，原有城市因子值及类型（如人均资源、房价、拥堵度等）。

- **计算**：对不同因子类型采用不同反馈规则：

    - 人均资源类（例如医生/万人数、公共设施）：假设总资源量不变，则人均值 $= \text{Total}/(\text{OldPop}+\Delta P)$。
      人口增加时人均资源下降；若允许模拟增补，可逐步增加总资源。

    - 价格/成本类（房价、租金）：一般视为需求驱动，人口每增加一定比例，价格上涨。可用弹性公式：
      $\Delta \text{Price} \approx \epsilon\times (\Delta P/P)$，其中弹性 $\epsilon>0$ 表示需求对价格的影响程度。

    - 负外部性（污染、拥堵）：通常随着人口密度上升而上升，可采用线性或非线性增加模型。例如
      $\text{Pollution}{\rm new}=\text{Pollution}{\rm old} + \beta,\Delta P$，或加上阈值、平方项等。

    - 正外部性/聚集效应（产业、经济活动）：人口增加可能带来经济增长、收入提高（至饱和点）。可增加相关因子，如经济产出、就业率等，
      可用递增函数模拟收益递减。

- **平滑处理**：为避免因因子剧烈震荡，可对新计算值做指数平滑：
  $\text{Value}{\rm final}=(1-\alpha),\text{Value}{\rm old} + \alpha,\text{Value}_{\rm new}$。
  其中 $\alpha\in(0,1)$ 为平滑系数（默认如 0.2）。

- **输出**：各城市更新后的因子值。完成所有城市更新后，进入下一步迭代。

- **参数**：各因子更新规则的参数（如弹性 $\epsilon$、污染增加系数 $\beta$）可根据实际数据设定；
  平滑系数 $\alpha$（默认 0.1–0.3）控制稳定性。

### 时间步与算法稳定性

- **时间步**：每次迭代对应固定时间长度（如 1 个月），确保迁移与反馈按时推进。在城市宏观模拟中，月度步长较为常用。可根据需求调整（如季度、年）。

- **稳定策略**：采用指数平滑更新因子可避免波动过大。此外，可限制每步最大迁移比例，防止瞬时人口过度跃迁。若引入随机抽样，本身也有助于分散冲击。
  最终，重复迭代直到达到预定步数或系统收敛稳定。

### 参数说明（示例默认值）

- 因子定义：**方向**（拉力/推力）、**标准化**方法（MinMax、对数等）。

- **人口群体属性**：数量 $N_G$；迁移意愿上限 $m$（默认 0.2）；保留率 $r$（0.05）；
  吸引阈值 $\tau$（0.0）；最低吸引力 $\alpha_{\min}$（0.0）。

- **敏感度权重** $w_i$：群体对各因子的重视程度（总和 1），初始可等分或根据问卷数据设定。

- **Sigmoid 陡峭度** $k$（默认 1）；成本衰减系数 $\lambda$（默认约 0.01–0.1）。

- **城市容量** $K_C$：最大承载人口，根据城市规模和基础设施估计（如上限住户数）。

- **价格弹性** $\epsilon$（房价对人口变化敏感度，默认 0.3）；污染系数 $\beta$（人口增量对污染影响系数）。

- **平滑系数** $\alpha$（默认 0.2）。

- **时间步长**：一个模拟步长对应时长（默认 1 个月）。